FROM node:20-alpine

WORKDIR /app

# Install pnpm globally
RUN npm install -g pnpm

# Copy application code
COPY saga-fe /app

# Install dependencies (set CI=true to avoid TTY issues)
ENV CI=true
RUN pnpm install

# API base URL - relative path works everywhere
ENV VITE_API_BASE_URL=/api
ENV VITE_API_KEY=785fc6c1647ff650b6b611509cc0a8f47009e6b743340503519d433f111fcf12

# Build for production
RUN pnpm run build

# Serve the built files
CMD ["pnpm", "run", "preview", "--host"]
