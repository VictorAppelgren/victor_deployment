FROM node:20-alpine

WORKDIR /app

# Install pnpm globally
RUN npm install -g pnpm

# Copy application code
COPY saga-fe /app

# Install dependencies (allow lockfile updates)
RUN pnpm install --no-frozen-lockfile

# API base URL - relative path works everywhere
ENV VITE_API_BASE_URL=/api

# Build for production
RUN pnpm run build

# Serve the built files
CMD ["pnpm", "run", "preview", "--host"]
