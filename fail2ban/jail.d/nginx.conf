# Fail2ban jail configuration for Nginx
# Bans IPs that scan for vulnerabilities or make excessive bad requests
# Philosophy: Automated scanners don't learn - ban them for a long time

[DEFAULT]
# Default ban: 1 week
bantime = 1w
# Look at last 10 minutes of logs
findtime = 10m
# Ban after 10 failures
maxretry = 10
# Use iptables to ban
banaction = iptables-multiport

# ============================================
# NGINX BOT SEARCH - Catches .env scanners
# ============================================
[nginx-botsearch]
enabled = true
port = http,https
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
# Single probe for .env = you're a bot, gone for 30 days
maxretry = 2
findtime = 1m
bantime = 30d

# ============================================
# NGINX BAD REQUEST - Catches malformed requests
# ============================================
[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 5
findtime = 5m
bantime = 1w

# ============================================
# NGINX 4XX FLOOD - Catches excessive 404s/403s
# ============================================
[nginx-4xx]
enabled = true
port = http,https
filter = nginx-4xx
logpath = /var/log/nginx/access.log
# Allow some 404s (normal browsing), but ban floods
maxretry = 30
findtime = 1m
bantime = 1w

# ============================================
# NGINX LIMIT REQ - Catches rate limit violations
# ============================================
[nginx-limit-req]
enabled = true
port = http,https
filter = nginx-limit-req
logpath = /var/log/nginx/error.log
maxretry = 10
findtime = 1m
bantime = 1w
